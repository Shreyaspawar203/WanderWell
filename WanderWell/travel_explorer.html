<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WanderWell</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            transition: background-image 0.5s ease-in-out;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgb(0,0,0);
            background-color: rgba(0,0,0,0.4);
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: #fefefe;
            padding: 24px;
            border-radius: 12px;
            max-width: 500px;
            width: 90%;
            text-align: center;
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">

    <!-- API Key Warning Modal -->
    <div id="api-key-modal" class="modal">
        <div class="modal-content">
            <h2 class="text-xl font-bold text-red-600 mb-4">API Keys Required!</h2>
            <p class="text-gray-700">Please replace the placeholder API keys in the JavaScript section of the code with your own API keys. The app will not work otherwise.</p>
            <p class="mt-4 text-sm text-gray-500">
                You can get free keys from Unsplash and OpenWeatherMap by signing up on their websites.
            </p>
            <button id="close-modal-button" class="mt-6 px-6 py-2 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700 transition-colors duration-300">
                Got It
            </button>
        </div>
    </div>

    <div class="bg-white bg-opacity-90 backdrop-filter backdrop-blur-sm rounded-3xl shadow-xl max-w-4xl w-full p-8 space-y-8">
        <!-- Header Section -->
        <header class="text-center">
            <h1 class="text-4xl md:text-5xl font-bold text-gray-800 tracking-tight">WanderWell</h1>
            <p class="mt-2 text-lg text-gray-500">Simplify your trip planning.</p>
        </header>

        <!-- Search Input -->
        <div class="relative">
            <input type="text" id="destination-input" placeholder="Search for a destination..."
                   class="w-full px-6 py-4 pr-16 text-lg rounded-full border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-300 shadow-md">
            <button id="search-button"
                    class="absolute inset-y-0 right-0 flex items-center pr-5 text-gray-500 hover:text-blue-600 transition-colors duration-300">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                </svg>
            </button>
        </div>
        
        <!-- Recent Searches Section -->
        <div id="recent-searches-container" class="space-y-2 hidden">
            <h3 class="text-sm font-semibold text-gray-600">Recent Searches:</h3>
            <div id="recent-searches" class="flex flex-wrap gap-2">
                <!-- Recent searches will be dynamically inserted here -->
            </div>
        </div>

        <!-- Loading and Error Messages -->
        <div id="loading-message" class="hidden text-center text-gray-500 animate-pulse">
            Loading...
        </div>
        <div id="error-message" class="hidden text-center text-red-500 font-medium">
            <!-- Error message will be displayed here -->
        </div>

        <!-- Main Content Area -->
        <main id="main-content" class="hidden space-y-8">
            <!-- Destination & Weather Info -->
            <section class="bg-gray-100 p-6 rounded-2xl shadow-inner-lg">
                <div class="flex flex-col md:flex-row justify-between items-center space-y-4 md:space-y-0 md:space-x-8">
                    <div class="text-center md:text-left flex-grow">
                        <h2 id="destination-name" class="text-3xl md:text-4xl font-bold text-gray-800"></h2>
                        <p id="weather-description" class="mt-1 text-xl text-gray-600 capitalize"></p>
                    </div>
                    <div class="flex items-center space-x-4">
                        <img id="weather-icon" src="" alt="Weather icon" class="w-16 h-16">
                        <div>
                            <p id="temperature" class="text-4xl md:text-5xl font-bold text-gray-800"></p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 5-Day Forecast Section -->
            <section>
                <h3 class="text-2xl font-semibold text-gray-800 mb-4">5-Day Forecast</h3>
                <div id="forecast-container" class="grid grid-cols-2 md:grid-cols-5 gap-4">
                    <!-- Forecast items will be dynamically inserted here -->
                </div>
            </section>

            <!-- Currency Converter Section -->
            <section>
                <h3 class="text-2xl font-semibold text-gray-800 mb-4">Currency Converter</h3>
                <div class="flex flex-col md:flex-row items-center space-y-4 md:space-y-0 md:space-x-4">
                    <input type="number" id="base-amount" value="1" min="1" class="w-full md:w-1/3 px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 text-lg">
                    <select id="base-currency" class="w-full md:w-1/4 px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 text-lg">
                        <option value="USD">USD</option>
                        <option value="EUR">EUR</option>
                        <option value="GBP">GBP</option>
                        <option value="JPY">JPY</option>
                        <option value="INR" selected>INR</option>
                    </select>
                    <span class="text-2xl font-bold text-gray-700">=</span>
                    <input type="text" id="converted-amount" readonly class="w-full md:w-1/3 px-4 py-2 rounded-lg border border-gray-300 bg-gray-100 text-lg font-bold">
                </div>
                <p id="conversion-rate-info" class="mt-2 text-sm text-gray-500 text-center md:text-left"></p>
            </section>

            <!-- Photo Gallery Section -->
            <section>
                <h3 class="text-2xl font-semibold text-gray-800 mb-4">Photos</h3>
                <div id="photo-gallery" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- Photos will be dynamically inserted here -->
                </div>
            </section>
        </main>
    </div>

    <script>
        window.onload = function() {
            // Show the modal on page load
            const apiKeyModal = document.getElementById('api-key-modal');
            const closeModalButton = document.getElementById('close-modal-button');
            apiKeyModal.style.display = 'none';

            closeModalButton.addEventListener('click', () => {
                apiKeyModal.style.display = 'none';
            });

            // --- API Keys (Replace with your own) ---
            const UNSPLASH_API_KEY = 'jZgdaBTM2m2tzjqeycFG4_X5JsdDtP19ADWiuk2ZAC4';
            const OPENWEATHER_API_KEY = '3d9bba05c68bd011eaef3a8b557ac921';
            const CURRENCY_API_KEY = 'acba28327885d2592a95478d';
            const BASE_URL_OPENWEATHER = 'https://api.openweathermap.org/data/2.5';
            const BASE_URL_CURRENCY = 'https://v6.exchangerate-api.com/v6';

            // --- DOM Elements ---
            const destinationInput = document.getElementById('destination-input');
            const searchButton = document.getElementById('search-button');
            const loadingMessage = document.getElementById('loading-message');
            const errorMessage = document.getElementById('error-message');
            const mainContent = document.getElementById('main-content');
            const destinationName = document.getElementById('destination-name');
            const temperature = document.getElementById('temperature');
            const weatherDescription = document.getElementById('weather-description');
            const weatherIcon = document.getElementById('weather-icon');
            const photoGallery = document.getElementById('photo-gallery');
            const recentSearchesContainer = document.getElementById('recent-searches-container');
            const recentSearchesDiv = document.getElementById('recent-searches');
            const forecastContainer = document.getElementById('forecast-container');
            const baseAmountInput = document.getElementById('base-amount');
            const baseCurrencySelect = document.getElementById('base-currency');
            const convertedAmountInput = document.getElementById('converted-amount');
            const conversionRateInfo = document.getElementById('conversion-rate-info');
            let exchangeRates = {};
            let destinationCurrency = '';

            // --- Event Listeners ---
            searchButton.addEventListener('click', searchDestination);
            destinationInput.addEventListener('keypress', (event) => {
                if (event.key === 'Enter') {
                    searchDestination();
                }
            });

            // Handle clicks on recent search buttons
            recentSearchesDiv.addEventListener('click', (event) => {
                if (event.target.tagName === 'BUTTON') {
                    destinationInput.value = event.target.textContent;
                    searchDestination();
                }
            });

            // Currency converter event listeners
            baseAmountInput.addEventListener('input', convertCurrency);
            baseCurrencySelect.addEventListener('change', convertCurrency);

            // --- Main Functionality ---
            async function searchDestination() {
                const destination = destinationInput.value.trim();
                if (!destination) {
                    showError('Please enter a destination.');
                    return;
                }

                showLoading();
                hideContent();
                
                try {
                    const [weatherResponse, photosResponse, forecastResponse] = await Promise.all([
                        fetch(`${BASE_URL_OPENWEATHER}/weather?q=${destination}&appid=${OPENWEATHER_API_KEY}`),
                        fetch(`https://api.unsplash.com/search/photos?query=${destination}&client_id=${UNSPLASH_API_KEY}&per_page=9`),
                        fetch(`${BASE_URL_OPENWEATHER}/forecast?q=${destination}&appid=${OPENWEATHER_API_KEY}`)
                    ]);

                    // Check for invalid API key
                    if (weatherResponse.status === 401 || photosResponse.status === 401 || forecastResponse.status === 401) {
                         throw new Error('Invalid API Key. Please make sure you have entered the correct keys.');
                    }
                    if (!weatherResponse.ok) {
                        throw new Error('Destination not found. Please try another.');
                    }
                    
                    const weatherData = await weatherResponse.json();
                    const photosData = photosResponse.ok ? await photosResponse.json() : { results: [] };
                    const forecastData = forecastResponse.ok ? await forecastResponse.json() : null;

                    displayWeather(weatherData);
                    displayPhotos(photosData);
                    displayForecast(forecastData);
                    setDynamicBackground(photosData);
                    addRecentSearch(destination);

                    // Determine destination currency and fetch exchange rates
                    const countryCode = weatherData.sys.country;
                    destinationCurrency = getCurrencyCode(countryCode);
                    await fetchExchangeRates();

                    showContent();

                } catch (error) {
                    showError(error.message);
                } finally {
                    hideLoading();
                }
            }

            // --- New Feature Functions ---
            async function fetchExchangeRates() {
                try {
                    const baseCurrency = baseCurrencySelect.value;
                    const response = await fetch(`${BASE_URL_CURRENCY}/${CURRENCY_API_KEY}/latest/${baseCurrency}`);
                    const data = await response.json();
                    if (data.result === 'success') {
                        exchangeRates = data.conversion_rates;
                        convertCurrency();
                    } else {
                        throw new Error('Failed to fetch exchange rates. Check your currency API key.');
                    }
                } catch (error) {
                    console.error('Error fetching exchange rates:', error);
                    conversionRateInfo.textContent = 'Error fetching exchange rates.';
                }
            }

            function convertCurrency() {
                const amount = parseFloat(baseAmountInput.value);
                const baseCurrency = baseCurrencySelect.value;
                const rate = exchangeRates[destinationCurrency];

                if (!rate || isNaN(amount)) {
                    convertedAmountInput.value = 'N/A';
                    conversionRateInfo.textContent = 'Currency data not available.';
                    return;
                }

                const convertedValue = (amount * rate).toFixed(2);
                convertedAmountInput.value = convertedValue;
                conversionRateInfo.textContent = `1 ${baseCurrency} = ${rate.toFixed(2)} ${destinationCurrency}`;
            }

            function getCurrencyCode(countryCode) {
                const currencyMap = {
                    'US': 'USD', 'CA': 'CAD', 'GB': 'GBP', 'DE': 'EUR', 'FR': 'EUR', 'IN': 'INR', 'JP': 'JPY',
                    'MX': 'MXN', 'AU': 'AUD', 'BR': 'BRL', 'RU': 'RUB', 'CN': 'CNY', 'SA': 'SAR', 'AE': 'AED',
                    'EG': 'EGP', 'AR': 'ARS', 'TR': 'TRY', 'CH': 'CHF', 'SE': 'SEK', 'NO': 'NOK', 'DK': 'DKK',
                    'PL': 'PLN', 'ZA': 'ZAR', 'SG': 'SGD', 'NZ': 'NZD'
                };
                return currencyMap[countryCode] || 'USD';
            }
            
            function setDynamicBackground(photosData) {
                if (photosData.results.length > 0) {
                    const imageUrl = photosData.results[0].urls.regular;
                    document.body.style.backgroundImage = `linear-gradient(rgba(255, 255, 255, 0.4), rgba(255, 255, 255, 0.4)), url('${imageUrl}')`;
                } else {
                    document.body.style.backgroundImage = `none`;
                    document.body.style.backgroundColor = '#f0f4f8';
                }
            }

            function displayForecast(data) {
                forecastContainer.innerHTML = ''; // Clear previous forecast
                if (!data) {
                    forecastContainer.innerHTML = '<p class="col-span-full text-center text-gray-500">Forecast data not available.</p>';
                    return;
                }
                // Group forecast data by day
                const forecastByDay = data.list.filter(item => item.dt_txt.includes("12:00:00"));

                forecastByDay.forEach(day => {
                    const date = new Date(day.dt * 1000);
                    const dayName = date.toLocaleDateString('en-US', { weekday: 'short' });
                    const temp = Math.round(day.main.temp);
                    const iconCode = day.weather[0]?.icon;
                    const description = day.weather[0]?.description;

                    const forecastItem = document.createElement('div');
                    forecastItem.className = 'flex flex-col items-center p-4 bg-gray-200 rounded-lg shadow-md';
                    forecastItem.innerHTML = `
                        <p class="text-sm font-semibold text-gray-600">${dayName}</p>
                        <img src="https://openweathermap.org/img/wn/${iconCode}@2x.png" alt="${description}" class="w-12 h-12">
                        <p class="text-lg font-bold text-gray-800">${temp}°C</p>
                    `;
                    forecastContainer.appendChild(forecastItem);
                });
            }

            function addRecentSearch(destination) {
                let searches = JSON.parse(localStorage.getItem('recentSearches')) || [];
                const maxSearches = 5;

                // Add to the front if not already in the list
                if (!searches.includes(destination)) {
                    searches.unshift(destination);
                    if (searches.length > maxSearches) {
                        searches.pop(); // Remove the oldest
                    }
                    localStorage.setItem('recentSearches', JSON.stringify(searches));
                }
                
                displayRecentSearches(searches);
            }

            function displayRecentSearches(searches) {
                recentSearchesDiv.innerHTML = ''; // Clear previous buttons
                if (searches.length > 0) {
                    recentSearchesContainer.classList.remove('hidden');
                    searches.forEach(search => {
                        const button = document.createElement('button');
                        button.textContent = search;
                        button.className = 'bg-gray-200 text-gray-700 text-sm py-1 px-3 rounded-full hover:bg-gray-300 transition-colors duration-200';
                        recentSearchesDiv.appendChild(button);
                    });
                } else {
                    recentSearchesContainer.classList.add('hidden');
                }
            }

            // --- Display Functions ---
            function displayWeather(data) {
                destinationName.textContent = data.name || 'Unknown Location';
                temperature.textContent = `${Math.round(data.main.temp)}°C`;
                weatherDescription.textContent = data.weather[0]?.description || 'N/A';
                
                const iconCode = data.weather[0]?.icon;
                if (iconCode) {
                    weatherIcon.src = `https://openweathermap.org/img/wn/${iconCode}@2x.png`;
                    weatherIcon.classList.remove('hidden');
                } else {
                    weatherIcon.classList.add('hidden');
                }
            }

            function displayPhotos(data) {
                photoGallery.innerHTML = ''; // Clear previous photos
                const photos = data.results;
                if (photos.length === 0) {
                    photoGallery.innerHTML = '<p class="text-center text-gray-500 col-span-full">No photos found for this destination.</p>';
                } else {
                    photos.forEach(photo => {
                        const imgContainer = document.createElement('div');
                        imgContainer.className = 'relative group cursor-pointer overflow-hidden rounded-xl shadow-lg transform transition-transform duration-300 hover:scale-105';
                        
                        const img = document.createElement('img');
                        img.src = photo.urls.small;
                        img.alt = photo.alt_description || 'Destination image';
                        img.className = 'w-full h-full object-cover';
                        
                        const overlay = document.createElement('div');
                        overlay.className = 'absolute inset-0 bg-black bg-opacity-40 flex items-end opacity-0 group-hover:opacity-100 transition-opacity duration-300 p-4';
                        
                        const photographerInfo = document.createElement('p');
                        photographerInfo.className = 'text-white text-sm truncate';
                        photographerInfo.textContent = `Photo by ${photo.user.name}`;

                        overlay.appendChild(photographerInfo);
                        imgContainer.appendChild(img);
                        imgContainer.appendChild(overlay);
                        photoGallery.appendChild(imgContainer);
                    });
                }
            }

            // --- UI State Management ---
            function showLoading() {
                loadingMessage.classList.remove('hidden');
                errorMessage.classList.add('hidden');
            }

            function hideLoading() {
                loadingMessage.classList.add('hidden');
            }

            function showError(message) {
                errorMessage.textContent = message;
                errorMessage.classList.remove('hidden');
            }

            function hideContent() {
                mainContent.classList.add('hidden');
            }
            
            function showContent() {
                mainContent.classList.remove('hidden');
            }

            // Initial load to show recent searches
            displayRecentSearches(JSON.parse(localStorage.getItem('recentSearches')) || []);
        };
    </script>
</body>
</html>
